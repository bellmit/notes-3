**答案**：一个高度为 3 的 B+ 树大概可以存放 1170 × 1170 × 16 = 21902400 行数据，已经是千万级别的数据量了。大多数项目也就是这个量级的数据了吧？再大的话也该拆分拆分了。

# 一、InnoDB的数据组织方式

在计算机中磁盘存储数据最小单元是扇区，一个扇区大小是 512字节，文件系统的最小单位是块，一个块的大小是 4K，InnoDB 存储引擎也有自己的最小存储单元-页（Page），一个页的大小是 16K。

文件系统中一个文件大小只有1个字节，但不得不占磁盘上4KB的空间。

![6FE06A97-54AB-498C-921F-F47F87AB2878](http://snail-resources.oss-cn-beijing.aliyuncs.com/1623815195.555636XcsE36KChj.png)

Innodb 的所有数据文件（后缀为 ibd 的文件），他的大小始终都是 16384（16k）的整数倍。

![v2-e5592447e14e944b7c427c9af10a8d97_r](http://snail-resources.oss-cn-beijing.aliyuncs.com/1623815208.143056dExfiMCypl.jpg)

磁盘扇区、文件系统、InnoDB 存储引擎都有各自的最小存储单元。

![v2-12d5521cde37c7256adae13e9108ab1e_r](http://snail-resources.oss-cn-beijing.aliyuncs.com/1623815228.4095519bNG54XUHxB.jpg)

在 MySQL 中我们的 InnoDB 页的大小默认是 16K，当然也可以通过参数设置：

```sql
mysql> show variables like 'innodb_page_size';
+------------------+-------+
| Variable_name  | Value |
+------------------+-------+
| innodb_page_size | 16384 |
+------------------+-------+
1 row in set (0.08 sec)
```

数据表中的数据都是存储在页中的，所以一个页中能存储多少行数据呢？

假设一行数据的大小是 1k，那么一个页可以存放 16 行这样的数据。

如果数据库只按这样的方式存储，那么如何查找数据就成为一个问题，因为我们不知道要查找的数据存在哪个页中，也不可能把所有的页遍历一遍，那样太慢了。

所以人们想了一个办法，用 B+ 树的方式组织这些数据。如图所示：

![v2-9347110b6ffefc556b46537152b81905_r](http://snail-resources.oss-cn-beijing.aliyuncs.com/1623815251.5661sIcQB0ivVT.jpg)

# 二、通常一棵 B+ 树可以存放多少数据？

假设树高为 2，即存在一个根节点和若干个叶子节点，那么这棵 B+ 树的存放总记录数为：根节点指针数 + 单个叶节点记录行数。

上文中，单个叶节点（页）的大小是 16K，通常一行记录的数据大小为 1K，那么一个叶节点就存放的记录数为 16K/1K=16。现在需要计算出非叶节点能存放多少指针？

假设主键 ID 为 bigint 类型，长度为 8字节，而指针大小在 InnoDB 源码中设置为 6字节，这样一共是 14字节，所以一个页中能存放 16384/14=1170 个（主键+指针）。这样一棵高度为 2 的 B+ 树能存放 1170*16=18720 条数据。

同样的原理，我们可以算出一棵高度为 3 的 B+ 树可以存放 1170 * 1170 * 16 = 21902400 条数据。所以 InnoDB 中 B+ 树高度一般为 1-3 层，它就能满足千万级的数据存储。在查询数据时，一次页的读取为一次 IO 操作，这样通过主键索引查询通常只需要 1-3 次 IO 操作即可查到数据。

# 三、为什么 MySQL 的索引要使用 B+ 树而不是其它树形结构？比如 B 树。

因为 B 树不管叶子节点还是非叶子节点，都会保存数据，这样导致在非叶子节点中能保存的指针数量变少（有些资料也称为扇出），指针少的情况下要保存大量数据，只能增加树的高度，导致 IO 操作变多，查询性能变低。
